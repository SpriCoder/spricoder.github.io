

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="SpriCoder">
  <meta name="keywords" content="">
  
    <meta name="description" content="2020-计算机网络-lecture09-局域网交换与VLAN">
<meta property="og:type" content="article">
<meta property="og:title" content="2020-计算机网络-lecture09-局域网交换与VLAN">
<meta property="og:url" content="https://spricoder.github.io/2020/07/05/2020-Internet-computing/2020-Internet-computing-lecture09-%E5%B1%80%E5%9F%9F%E7%BD%91%E4%BA%A4%E6%8D%A2%E4%B8%8EVLAN/index.html">
<meta property="og:site_name" content="SpriCoder的博客">
<meta property="og:description" content="2020-计算机网络-lecture09-局域网交换与VLAN">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/1.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/2.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/3.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/4.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/5.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/6.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/7.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/8.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/9.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/10.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/11.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/12.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/13.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/37.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/38.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/14.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/15.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/16.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/17.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/39.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/40.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/41.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/18.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/19.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/20.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/21.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/22.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/23.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/24.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/25.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/26.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/27.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/28.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/29.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/30.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/31.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/32.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/33.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/34.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/1.jpg">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/35.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/36.png">
<meta property="article:published_time" content="2020-07-05T11:09:00.000Z">
<meta property="article:modified_time" content="2022-03-07T10:41:04.225Z">
<meta property="article:author" content="SpriCoder">
<meta property="article:tag" content="课程笔记">
<meta property="article:tag" content="计算机网络">
<meta property="article:tag" content="局域网">
<meta property="article:tag" content="交换机">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/1.png">
  
  
  <title>2020-计算机网络-lecture09-局域网交换与VLAN - SpriCoder的博客</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://cdn.staticfile.org/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"spricoder.github.io","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"DYxfU2PHurs2yXd95Sq85bU2-gzGzoHsz","app_key":"YWKSJ5KaDC4GQh2F8JraQPBr","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>SpriCoder的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/website.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          <span id="subtitle" title="2020-计算机网络-lecture09-局域网交换与VLAN">
            
          </span>
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2020-07-05 19:09" pubdate>
          2020年7月5日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          8.7k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          73 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">2020-计算机网络-lecture09-局域网交换与VLAN</h1>
            
            <div class="markdown-body">
              
              <h2 id="lecture09-局域网交换与vlan"><a class="markdownIt-Anchor" href="#lecture09-局域网交换与vlan"></a> lecture09-局域网交换与VLAN</h2>
<ol>
<li>网桥和路由器一般是通过软件来完成的，基于操作系统的。</li>
<li>交换机是基于硬件的。</li>
</ol>
<h1 id="1-交换机"><a class="markdownIt-Anchor" href="#1-交换机"></a> 1. 交换机</h1>
<h2 id="11-交换机基本功能"><a class="markdownIt-Anchor" href="#11-交换机基本功能"></a> 1.1. 交换机基本功能</h2>
<ol>
<li>根据MAC地址建立和维护<strong>交换表</strong>(类似于网桥表)</li>
<li>将帧切换出接口到目标</li>
</ol>
<h2 id="12-对称交换symmetric-switching"><a class="markdownIt-Anchor" href="#12-对称交换symmetric-switching"></a> 1.2. 对称交换(Symmetric Switching)</h2>
<ol>
<li>对称交换可在具有相同带宽(10/10 Mbps或100/100 Mbps)的端口之间提供交换连接</li>
<li>用户尝试访问其他网段上的服务器时，可能会导致瓶颈(对称交换可能会导致带宽不足)</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/1.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<p>多个客户端向服务器访问的话，服务器端口流量会比较阻塞(在对称切换中，双端的带宽是完全对称的)，这是一个瓶颈。</p>
</blockquote>
<h2 id="13-非对称交换asymmetric-switching"><a class="markdownIt-Anchor" href="#13-非对称交换asymmetric-switching"></a> 1.3. 非对称交换(Asymmetric Switching)</h2>
<ol>
<li>通过将带有服务器的网段连接到更高带宽的端口(100 Mbps)，非对称交换(asymmetric switching)减少了服务器上潜在瓶颈的可能性</li>
<li>非对称交换需要在交换器中进行内存缓冲</li>
<li>非对称交换端口解决对称交换端口中的对称阻塞问题(进一步保证了服务器的稳定实现)</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/2.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h3 id="131-内存缓冲"><a class="markdownIt-Anchor" href="#131-内存缓冲"></a> 1.3.1. 内存缓冲</h3>
<ol>
<li>交换机中存储目标和传输数据的内存区域，直到可以将其切换出正确的端口为止。
<ol>
<li>基于端口(Port)的内存缓冲
<ol>
<li>数据包存储在每个端口的队列中</li>
<li>由于目标端口繁忙，一个数据包可能会延迟其他数据包的传输</li>
<li>其他端口存在不均衡的问题。</li>
</ol>
</li>
<li>共享(Shared)内存缓冲
<ol>
<li>所有端口共享的公用内存缓冲</li>
<li>允许将数据包在一个端口上接收并在另一个端口上发送出去，而无需将其更改为其他队列。</li>
<li>需要自己记录端口的信息</li>
</ol>
</li>
</ol>
</li>
<li>发生阻塞的时候，根据情况按照端口或者内存将包缓存下来</li>
</ol>
<h2 id="14-交换方式"><a class="markdownIt-Anchor" href="#14-交换方式"></a> 1.4. 交换方式</h2>
<h3 id="141-储存转发store-and-forward网桥-路由器等通过软件的设备"><a class="markdownIt-Anchor" href="#141-储存转发store-and-forward网桥-路由器等通过软件的设备"></a> 1.4.1. 储存转发(Store-and-Forward，网桥、路由器等通过软件的设备)</h3>
<ol>
<li>交换机<strong>接收整个帧</strong>，最后将其计算为CRC，然后再将其发送到目的地</li>
<li>接收后，校验，正确再发送</li>
</ol>
<h3 id="142-cut-through-直通"><a class="markdownIt-Anchor" href="#142-cut-through-直通"></a> 1.4.2. Cut-through 直通</h3>
<ol>
<li>转发会增加延迟:通过使用直通切换方法可以减少它</li>
<li>快速转发切换:仅在立即转发帧之前检查目标MAC(只看到帧的目的地址就转发，而不看帧的后面的部分)</li>
</ol>
<h3 id="143-segment-free-switching-无碎片转发"><a class="markdownIt-Anchor" href="#143-segment-free-switching-无碎片转发"></a> 1.4.3. Segment-free Switching 无碎片转发</h3>
<ol start="3">
<li>碎片释放:在转发帧之前读取前64个字节以减少错误:避免碰撞和帧碎片</li>
<li>Exmaple:(三种不同的查看方式)</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/3.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h2 id="15-第二层交换机"><a class="markdownIt-Anchor" href="#15-第二层交换机"></a> 1.5. 第二层交换机</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/4.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>大规模集成电路,保证链路效率,低时延,低成本</li>
<li>有一个MAC地址</li>
</ol>
<h2 id="16-第三层交换机"><a class="markdownIt-Anchor" href="#16-第三层交换机"></a> 1.6. 第三层交换机</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/5.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>基于硬件的帧转发机制，较高的帧转发性能，低时延</li>
<li>较高速的计算</li>
<li>每一个端口的代价低</li>
<li>流控制</li>
<li>安全性更高</li>
<li>对数据流进行路由，生成MAC和IP的映射</li>
<li>MAC地址过来的时候直接根据表从二层进行通过</li>
</ol>
<h2 id="17-第四层交换机"><a class="markdownIt-Anchor" href="#17-第四层交换机"></a> 1.7. 第四层交换机</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/6.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>数据段在数据报里面，数据报在数据帧里面</li>
<li>只要交换机可以看到数据帧的数据部分的首部</li>
<li>可以根据端口主机的应用特点进行一定的流量控制</li>
<li>和Net OS是不一样的,没有那么智能</li>
<li>识别到前80个字节的数据报长度，对指定应用进行管理</li>
</ol>
<h2 id="18-多层交换机总结"><a class="markdownIt-Anchor" href="#18-多层交换机总结"></a> 1.8. 多层交换机总结</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/7.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>一般我们只是用二层交换机</li>
<li>交换机可以简单识别第三层和第四层信息</li>
</ol>
<h1 id="2-生成树协议stp-the-spanning-tree-protocol"><a class="markdownIt-Anchor" href="#2-生成树协议stp-the-spanning-tree-protocol"></a> 2. 生成树协议(STP, The Spanning-Tree Protocol)</h1>
<h2 id="21-桥回路"><a class="markdownIt-Anchor" href="#21-桥回路"></a> 2.1. 桥回路</h2>
<ol>
<li>出于各种原因，网络中可能会出现<strong>环路</strong>。
<ol>
<li>通常，网络中的环路是故意(deliberate)提供冗余的结果。</li>
<li>也可能由于配置错误而发生:在桥接网络中，环路可能是绝对灾难性的两个主要原因：
<ol>
<li>广播回路(广播风暴)，没有TTL</li>
<li>路由表的错误</li>
</ol>
</li>
</ol>
</li>
<li>往往是<strong>第二层交换机</strong>的冗余导致的桥回路。</li>
<li>接入层到核心层的接入往往<strong>要有冗余</strong>，这个区域是主干网(backbone)</li>
</ol>
<h2 id="22-冗余造成了路由回路"><a class="markdownIt-Anchor" href="#22-冗余造成了路由回路"></a> 2.2. 冗余造成了路由回路</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/8.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>设备通过backbone和远端设备进行链接</li>
</ul>
<h2 id="23-第二层路由回路"><a class="markdownIt-Anchor" href="#23-第二层路由回路"></a> 2.3. 第二层路由回路</h2>
<ol>
<li>广播和第2层循环可能是危险的组合。</li>
<li>以太网帧没有TTL字段</li>
<li>以太网帧开始循环后，它可能会继续下去，直到有人关闭其中一台交换机或断开链路为止(外部条件)</li>
<li>交换机将抖动(flip flop)主机A的桥接表条目(创建极高的CPU利用率)。</li>
<li>消耗CPU和内存</li>
</ol>
<h3 id="231-第二层路由回路-泛洪单播帧"><a class="markdownIt-Anchor" href="#231-第二层路由回路-泛洪单播帧"></a> 2.3.1. 第二层路由回路-泛洪单播帧</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/9.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>过一段时间CAT-1和CAT-2没有收到Host-B的信息，删除表中的对应记录</li>
<li>在这之后，Host A发送给Host B信息，然后在CAT-1和CAT-2之间进行循环</li>
</ul>
<h2 id="24-生成树协议-综述"><a class="markdownIt-Anchor" href="#24-生成树协议-综述"></a> 2.4. 生成树协议 综述</h2>
<ol>
<li>生成树协议的元素
<ol>
<li>主要功能：在<strong>交换/桥接网络</strong>中允许<strong>冗余路径</strong>，而不会因环路的影响而引起延迟。</li>
<li>STP通过计算<strong>稳定的生成树</strong>网络拓扑来防止环路</li>
<li><strong>生成树帧</strong>(称为桥协议数据单元-BPDU)用于确定生成树拓扑</li>
</ol>
</li>
<li>在正常情况下禁用一些端口来防止出现冗余</li>
</ol>
<h3 id="241-stp决策顺序seqence"><a class="markdownIt-Anchor" href="#241-stp决策顺序seqence"></a> 2.4.1. STP决策顺序(Seqence)</h3>
<ol>
<li>生成树始终使用相同的四步决策序列：
<ol>
<li>在拓扑里面最低的root BID(网桥标识)</li>
<li>找到 Root bridgh的最低路径成本</li>
<li>每个路径都会选择一个最低BID的sender 这个是针对一个链路的，详见例子</li>
<li>每个路径再指定一个最低的ID端口</li>
</ol>
</li>
</ol>
<h3 id="242-bpdusbridge-protocol-data-unit"><a class="markdownIt-Anchor" href="#242-bpdusbridge-protocol-data-unit"></a> 2.4.2. BPDUs(Bridge Protocol Data Unit)</h3>
<ol>
<li>BPDU是交换机之间的流量；它们不承载最终用户(end-user)流量。</li>
<li>STP建立一个称为<strong>根网桥的根节点</strong>，生成的树源自根桥。</li>
<li>不属于最短路径树的冗余连接将被阻止。(block 端口，不转发，但是接收)</li>
<li>在阻塞的链接上收到的数据帧将被丢弃。</li>
<li>交换机发送的允许形成无环逻辑拓扑的消息是BPDU</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/10.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>BPDU里面包含几个字段标识协议、版本、数据类型、标志等，记录它认可的Root BID(类似OSPF)、到BID最小的代价、发送的交换机的ID、从哪个端口发送</li>
<li>和OSPF不一样的:不一定以自己为根</li>
<li>这样在选举之后，冗余链路就被屏蔽掉了。</li>
</ul>
<h3 id="243-stp的bpdu帧"><a class="markdownIt-Anchor" href="#243-stp的bpdu帧"></a> 2.4.3. STP的BPDU帧</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/11.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>注意前四个是很有意义的</li>
<li>默认交换机每2s发送一次BPDU</li>
<li>主要是维护最短的路径</li>
<li>接收到BPDU帧的时候，会比较根ID，计算，如果更优则接受，反之则不接受。</li>
<li>经过一段时间的传递后会全局稳定。</li>
</ul>
<h3 id="244-bridge-identificationbid"><a class="markdownIt-Anchor" href="#244-bridge-identificationbid"></a> 2.4.4. Bridge Identification/BID</h3>
<ol>
<li>网桥ID(BID)：8个字节(2 + 6)
<ol>
<li>高阶BID子字段(2个字节)：网桥优先级
<ol>
<li>2<sup>16</sup>个可能的值：0-65,535(默认值：32,768)</li>
<li>通常以十进制格式表示</li>
</ol>
</li>
<li>低阶子字段(6个字节)：分配给交换机的MAC地址，以十六进制格式表示</li>
</ol>
</li>
<li>STP成本值：成本越低越好。</li>
</ol>
<h3 id="245-选举根交换机"><a class="markdownIt-Anchor" href="#245-选举根交换机"></a> 2.4.5. 选举根交换机</h3>
<ol>
<li>交换机通过查找具有<strong>最低BID</strong>的交换机(通常称为根战争)来选择单个根交换机。</li>
<li>如果所有交换机都使用默认的网桥优先级32768，则最低的MAC地址将作为平局。</li>
<li>配置优先级来调整根桥</li>
</ol>
<h2 id="25-路径代价-cost"><a class="markdownIt-Anchor" href="#25-路径代价-cost"></a> 2.5. 路径代价 Cost</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/12.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>桥梁使用成本的概念来评估它们与其他桥梁的距离。</li>
<li>和OSPF算法相同的，这个标准是比较合适的，比之前OSPF要新，用固定的数值除以带宽来获得代价</li>
</ol>
<h2 id="26-five-stp-states-5个stp状态"><a class="markdownIt-Anchor" href="#26-five-stp-states-5个stp状态"></a> 2.6. Five STP States 5个STP状态</h2>
<ol>
<li>通过根据策略配置每个端口来建立状态</li>
<li>然后，STP根据流量模式(traffic Patterns)和潜在环路(Protential Loops)修改状态</li>
<li>STP状态的默认顺序为：
<ol>
<li>阻塞:没有转发帧，听到了BPDU</li>
<li>监听:不转发任何帧，监听数据帧(确定自己可以参加的交换)，也会发送一些数据帧表示自己状态变了</li>
<li>学习:不转发帧，学习地址</li>
<li>转发:转发帧，学习地址</li>
<li>禁用:没有转发帧，没有听到BPDU</li>
</ol>
</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/13.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<p>STP过程:Blocking -&gt; 20s Listening -&gt; 15s Learning -&gt; 15s Fowarding或者Disabled</p>
</blockquote>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/37.png" srcset="/img/loading.gif" lazyload alt="" /><br />
<img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/38.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>2s可以调整</li>
<li>老化时间:保存的时间</li>
</ul>
<h2 id="27-初始stp收敛"><a class="markdownIt-Anchor" href="#27-初始stp收敛"></a> 2.7. 初始STP收敛</h2>
<ol>
<li>当网络首次启动时，所有网桥都会混合使用BPDU信息来泛洪网络。(开始泛洪BPDU信息)</li>
<li>立即，他们应用决策序列，允许他们BPDU进行PK，然后选择出来ROOT，从而形成整个网络的单个生成树。</li>
</ol>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit">(<span class="hljs-keyword">Step</span> <span class="hljs-number">1</span>) 根交换机决定：选择一个根桥作为该网络的中心点<br>(<span class="hljs-keyword">Step</span> <span class="hljs-number">2</span>) 选择根端口：所有剩余的网桥都会计算出一组根端口<br>(<span class="hljs-keyword">Step</span> <span class="hljs-number">3</span>) 选择指定端口：其余所有网桥计算一组指定端口<br></code></pre></td></tr></table></figure>
<ul>
<li>Root switch针对一个特定的交换机</li>
<li>根端口针对一个交换机</li>
<li>指定端口对应链路</li>
</ul>
<h3 id="271-步骤1根交换机决定"><a class="markdownIt-Anchor" href="#271-步骤1根交换机决定"></a> 2.7.1. 步骤1：根交换机决定</h3>
<ol>
<li>宣布自己为根</li>
<li>检查端口上收到的所有BPDU以及将在该端口上发送的BPDU</li>
<li>对于每个到达的BPDU，如果其值小于为端口保存的现有BPDU</li>
<li>旧值被替换</li>
<li>BPDU的发送者被接受为新的根</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/14.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>BC收到后将根修改为A</li>
<li>比如在BC链路中，B的MAC地址比较小，作为链路的Sender BID，这个port是指定端口。</li>
</ul>
<h3 id="272-步骤2选择根端口"><a class="markdownIt-Anchor" href="#272-步骤2选择根端口"></a> 2.7.2. 步骤2：选择根端口</h3>
<ol>
<li>每个非根桥必须选择一个根端口。
<ol>
<li>桥的根端口是最接近根桥的端口。</li>
<li>根路径成本是到根网桥的所有链接的累积(cumulative)成本。</li>
</ol>
</li>
<li>STP成本随着在端口上接收到BPDU而增加，而不是随着它们从端口发送出去而增加。</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/15.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<p>B会把上面一个端口做为Root Port，虽然两个可达，但是上面一个更快，C也是同样</p>
</blockquote>
<h3 id="273-步骤3选择网段的指定端口i"><a class="markdownIt-Anchor" href="#273-步骤3选择网段的指定端口i"></a> 2.7.3. 步骤3：选择网段的指定端口(I)</h3>
<ol>
<li>每个网段都有一个指定的端口：充当单个网桥/交换机端口，该端口既向该网段又向根网桥发送流量，也从该网段和根网桥接收流量。</li>
<li>包含给定网段的指定端口的网桥/交换机称为该网段的指定网桥。</li>
<li>所有网桥/交换机将阻止它们上未指定的端口，根网桥上的每个活动端口都将成为指定端口</li>
<li>每个链路只有一个指定端口，一旦选定其他就block了</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/16.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>BC之间的，左边是指定端口(BID小)</li>
<li>MAC地址唯一的</li>
<li>Root Port都是上面的</li>
</ul>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/17.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>AB和AC之间的链路的指定端口是A上面的端口。</li>
</ul>
<h1 id="3-vlanvirtual-local-area-network-虚拟局域网"><a class="markdownIt-Anchor" href="#3-vlanvirtual-local-area-network-虚拟局域网"></a> 3. VLAN(Virtual Local Area Network 虚拟局域网)</h1>
<h2 id="31-为什么引入vlan"><a class="markdownIt-Anchor" href="#31-为什么引入vlan"></a> 3.1. 为什么引入VLAN？</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/39.png" srcset="/img/loading.gif" lazyload alt="" /><br />
<img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/40.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h2 id="32-vlan可以不通过路由器就隔离广播域吗"><a class="markdownIt-Anchor" href="#32-vlan可以不通过路由器就隔离广播域吗"></a> 3.2. VLAN可以不通过路由器就隔离广播域吗？</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/41.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h2 id="33-虚拟局域网介绍"><a class="markdownIt-Anchor" href="#33-虚拟局域网介绍"></a> 3.3. 虚拟局域网介绍</h2>
<h3 id="331-现有的共享局域网配置"><a class="markdownIt-Anchor" href="#331-现有的共享局域网配置"></a> 3.3.1. 现有的共享局域网配置</h3>
<ol>
<li>在典型的共享局域网中…
<ol>
<li>根据用户所插入(plug)的集线器对用户进行物理分组</li>
<li>路由器分割局域网并提供广播防火墙</li>
</ol>
</li>
<li>在虚拟局域网中
<ol>
<li>您可以按使用的功能，部门或应用程序对用户进行逻辑分组</li>
<li>通过专有软件进行配置</li>
</ol>
</li>
</ol>
<h3 id="332-lan和vlan之间的差异"><a class="markdownIt-Anchor" href="#332-lan和vlan之间的差异"></a> 3.3.2. LAN和VLAN之间的差异</h3>
<ol>
<li>虚拟局域网
<ol>
<li>在第2层和第3层工作</li>
<li>控制网络广播</li>
<li>允许用户由网络管理员分配。</li>
<li>提供更严格的网络安全性。</li>
</ol>
</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/18.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>左边是基于地理位置划分成子网(传统局域网)</li>
<li>VLAN是是通过逻辑位置进行划分</li>
<li>VLAN1的报文不会发送给VLAN2(虽然连接在一个交换机上)</li>
</ul>
<h3 id="333-vlans-ieee-8021q"><a class="markdownIt-Anchor" href="#333-vlans-ieee-8021q"></a> 3.3.3. VLANs (IEEE 802.1q)</h3>
<ol>
<li>特点
<ol>
<li>不限于物理交换机网段的网络设备或用户的<strong>逻辑分组</strong>。</li>
<li>VLAN中的设备或用户可以按功能，部门，应用程序等进行分组，而<strong>不管其物理网段的位置</strong>如何。</li>
<li>VLAN<strong>创建一个不限于物理网段</strong>的单个广播域，并且将其视为子网。</li>
<li>VLAN设置是由网络管理员使用供应商的软件在交换机中完成的。</li>
</ol>
</li>
<li>优点:
<ol>
<li>限制广播包，提高带宽的利用率。</li>
<li>增强通信的安全性:其他VLAN用户网络收不到非本VLAN的报文，避免被监听</li>
<li>创建虚拟工作组：可以一个部门工作的人划分为一个VLAN，这样子即使他移动了办公位置，仍然能够正常办公</li>
<li>增强网络的健壮性：将一些网络故障限制在一个VLAN中</li>
</ol>
</li>
</ol>
<h3 id="334-分组用户"><a class="markdownIt-Anchor" href="#334-分组用户"></a> 3.3.4. 分组用户</h3>
<ol>
<li>VLAN可以从逻辑上将用户划分为不同的子网(广播域)</li>
<li>广播帧仅在具有相同VLAN ID的一个或多个交换机的端口之间切换。(VLAN ID属于端口)</li>
<li>可以通过基于以下内容的软件对用户进行逻辑分组：
<ol>
<li>端口号</li>
<li>MAC地址</li>
<li>使用的协议</li>
<li>使用的应用</li>
</ol>
</li>
</ol>
<h4 id="3341-没有-vlan-时的网络广播"><a class="markdownIt-Anchor" href="#3341-没有-vlan-时的网络广播"></a> 3.3.4.1. 没有 VLAN 时的网络广播</h4>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/19.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<p>大家在一个交换机上不可以进行划分</p>
</blockquote>
<h4 id="3342-划分了vlan的网络广播"><a class="markdownIt-Anchor" href="#3342-划分了vlan的网络广播"></a> 3.3.4.2. 划分了VLAN的网络广播</h4>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/20.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<p>各自角色之间单独进行通信，虽然连接的是同一个交换机，如果不在同一个VLAN上，相互之间也不能通信</p>
</blockquote>
<h3 id="335-vlan-间通信"><a class="markdownIt-Anchor" href="#335-vlan-间通信"></a> 3.3.5. VLAN 间通信</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/21.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>首先127.17.10.21询问网关地址(ARQ)</li>
<li>路由器帮忙转发(VLAN的交换需要路由器的支持)</li>
<li>交换机S2的不同端口在不同的VLAN，S1和S2、S1和S3之间是VLAN骨干</li>
</ul>
<h3 id="336-vlan-和第3层转发来控制广播域"><a class="markdownIt-Anchor" href="#336-vlan-和第3层转发来控制广播域"></a> 3.3.6. VLAN 和第3层转发来控制广播域</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/22.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<p>第三层交换机:为每一个网段设置一个SVI(switch virtual interface,虚拟交换机结构，也可以理解为子接口)，通过这个来进行不同网段之间的通信</p>
</blockquote>
<h2 id="34-vlan的结构"><a class="markdownIt-Anchor" href="#34-vlan的结构"></a> 3.4. VLAN的结构</h2>
<h3 id="341-虚拟局域网通过骨干网backbone"><a class="markdownIt-Anchor" href="#341-虚拟局域网通过骨干网backbone"></a> 3.4.1. 虚拟局域网通过骨干网(BackBone)</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/23.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>VLAN配置需要支持互连的路由器和交换机之间的骨干数据传输。</li>
<li>骨干网是用于VLAN间通信的区域</li>
<li>骨干网应该是高速链路，通常为100Mbps或更高</li>
<li>BackBone可以跑多个VLAN，是骨干网</li>
</ol>
<h3 id="342-在虚拟局域网中的路由器的作用"><a class="markdownIt-Anchor" href="#342-在虚拟局域网中的路由器的作用"></a> 3.4.2. 在虚拟局域网中的路由器的作用</h3>
<ol>
<li>路由器提供不同VLAN之间的连接</li>
<li>例如，您有VLAN1和VLAN2。
<ol>
<li>在交换机内，位于不同VLAN上的用户无法相互通信(VLAN的好处！)</li>
<li>但是，VLAN1上的用户可以向VLAN2上的用户发送电子邮件，但他们需要路由器才能执行此操作。</li>
</ol>
</li>
</ol>
<h3 id="343-在虚拟局域网中的帧的使用"><a class="markdownIt-Anchor" href="#343-在虚拟局域网中的帧的使用"></a> 3.4.3. 在虚拟局域网中的帧的使用</h3>
<ol>
<li>交换机根据帧中的数据做出过滤和转发决策。</li>
<li>使用了两种技术
<ol>
<li>帧过滤：检查有关每个帧的特定信息(MAC地址或第3层协议类型),特定的VLAN记录或者映射</li>
<li>帧标记：在整个网络骨干网中转发时，在每个帧的标题中放置一个唯一的标识符。</li>
</ol>
</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/24.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h4 id="3431-frame-filiter-帧过滤"><a class="markdownIt-Anchor" href="#3431-frame-filiter-帧过滤"></a> 3.4.3.1. Frame Filiter 帧过滤</h4>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/25.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>收到帧转发后，发现都不在一个LAN上，然后通过Backbone转发</li>
<li>Frame Table在交换机上传输</li>
</ul>
<h4 id="3432-frame-tagging-帧标记"><a class="markdownIt-Anchor" href="#3432-frame-tagging-帧标记"></a> 3.4.3.2. Frame Tagging 帧标记</h4>
<ol>
<li>帧标记实施过程：
<ol>
<li>在整个网络骨干网中转发时，在每个帧的标题中放置一个VLAN标识符。</li>
<li>每个开关都可以理解和检查标识符。</li>
<li>当帧离开网络骨干网时，交换机会在帧发送到目标终端站之前删除标识符。只和端口绑定，而不影响主机</li>
</ol>
</li>
<li>帧标记在第2层起作用，并且几乎不需要处理或管理开销。</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/26.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="3">
<li>从主机到了交换机端口，交换机端口进行标记，然后进行转发。</li>
</ol>
<h3 id="344-frame-tagging-ieee8021q-and-isl"><a class="markdownIt-Anchor" href="#344-frame-tagging-ieee8021q-and-isl"></a> 3.4.4. Frame Tagging – IEEE802.1Q and ISL</h3>
<ol>
<li>IEEE802.1Q:IEEE标准，在标头中插入VLAN的标签以标识所属的VLAN。(帧标记)。</li>
<li>ISL(Inter-Switch Link)：思科专有。ISL在数据帧的前面添加一个26字节的标头，并在末尾附加一个CRC(4字节)。</li>
<li>推荐用IEEE802.Q</li>
<li>标记一般在BackBone上</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/27.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h2 id="35-虚拟局域网的实现"><a class="markdownIt-Anchor" href="#35-虚拟局域网的实现"></a> 3.5. 虚拟局域网的实现</h2>
<h3 id="351-端口-虚拟局域网和广播"><a class="markdownIt-Anchor" href="#351-端口-虚拟局域网和广播"></a> 3.5.1. 端口、虚拟局域网和广播</h3>
<ol>
<li>实现VLAN的两种方法
<ol>
<li>静态的</li>
<li>动态的</li>
</ol>
</li>
<li>每一个端口绑定给一个VLAN
<ol>
<li>确保不共享同一VLAN的端口不共享广播。</li>
<li>确保共享相同VLAN的端口将共享广播。</li>
</ol>
</li>
<li>实现途径:
<ol>
<li>基于端口的虚拟局域网</li>
<li>基于MAC地址的虚拟局域网</li>
<li>基于IP地址的虚拟局域网</li>
<li>基于上层协议的虚拟局域网</li>
</ol>
</li>
</ol>
<h3 id="352-静态vlans"><a class="markdownIt-Anchor" href="#352-静态vlans"></a> 3.5.2. 静态VLANS</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/28.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>定义：静态VLAN是指将交换机上的端口管理性地分配给VLAN的时间</li>
<li>优点：
<ol>
<li>安全，易于配置和监控</li>
<li>在控制移动的网络中效果很好</li>
</ol>
</li>
<li>端口是写死在交换机的端口上的</li>
</ol>
<h3 id="353-动态vlans"><a class="markdownIt-Anchor" href="#353-动态vlans"></a> 3.5.3. 动态VLANS</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/29.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<ol>
<li>一个服务器来配置VLAN的信息</li>
<li>交换机通过MAC地址或者哪一个协议，指定是哪一个VLAN</li>
</ol>
</blockquote>
<ol>
<li>当工作站最初连接到未分配的端口时，交换机会检查表中的条目，并使用正确的VLAN动态配置端口</li>
<li>优点
<ol>
<li>添加或移动用户时减少管理(更多前期工作)</li>
<li>集中通知未授权用户</li>
</ol>
</li>
</ol>
<h3 id="354-以端口为中心的vlan"><a class="markdownIt-Anchor" href="#354-以端口为中心的vlan"></a> 3.5.4. 以端口为中心的VLAN</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/30.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>实际的网络是有层次的</li>
<li>static的物理的接入层(physical Layer)</li>
<li>不同电脑在一个房间内</li>
<li>不同房间的不同电脑组成一个VLAN</li>
<li>路由器网关来处理</li>
</ul>
<h3 id="355-以端口为中心的vlan的优点"><a class="markdownIt-Anchor" href="#355-以端口为中心的vlan的优点"></a> 3.5.5. 以端口为中心的VLAN的优点</h3>
<ol>
<li>同一VLAN中的所有节点都连接到同一路由器接口</li>
<li>使管理更容易，因为…
<ol>
<li>通过路由器端口分配用户</li>
<li>VLAN易于管理。</li>
<li>提供更高的安全性</li>
<li>数据包不会&quot;泄漏&quot;到其他域</li>
</ol>
</li>
</ol>
<h3 id="356-接入和骨干连接"><a class="markdownIt-Anchor" href="#356-接入和骨干连接"></a> 3.5.6. 接入和骨干连接</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/31.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>分为两类:
<ol>
<li>接入链路:通过一个VLAN报文</li>
<li>骨干链路:通过多个VLAN报文</li>
</ol>
</li>
</ul>
<h3 id="357-访问连接"><a class="markdownIt-Anchor" href="#357-访问连接"></a> 3.5.7. 访问连接</h3>
<ol>
<li>访问连接是仅作为一个VLAN成员的交换机上的连接。</li>
<li>此VLAN被称为端口的本机VLAN，连接到端口的任何设备都完全不知道VLAN存在。</li>
</ol>
<h3 id="358-主干链路"><a class="markdownIt-Anchor" href="#358-主干链路"></a> 3.5.8. 主干链路</h3>
<ol>
<li>主干链路能够支持多个VLAN。</li>
<li>主干链路通常用于将交换机连接到其他交换机或路由器。</li>
<li>交换机在快速以太网和千兆位以太网端口上都支持骨干链路。</li>
<li>也存在访问和骨干链接</li>
<li>一般Trunk就是BackBone</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/32.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<ol>
<li>Sa和Sb上面连接使用单独的线，浪费</li>
<li>底下使用串行的线，不浪费端口</li>
</ol>
</blockquote>
<ol>
<li>骨干是支持多个VLAN的点对点链接</li>
<li>骨干用于在两个实现VLAN的设备之间创建链接时节省端口</li>
<li>骨干链路不属于特定的VLAN：充当交换机和路由器之间VLAN的通道。</li>
<li>可以将骨干链路配置为传输所有VLAN或有限数量的VLAN。</li>
<li>但是，骨干链路可能具有本地VLAN。</li>
<li>如果骨干线链路由于任何原因失败，则骨干线的本地VLAN是该骨干线使用的VLAN。</li>
<li>native VLAN是不发送无标记的信息。</li>
</ol>
<h3 id="359-交换机29xx中的配置"><a class="markdownIt-Anchor" href="#359-交换机29xx中的配置"></a> 3.5.9. 交换机29xx中的配置</h3>
<ol>
<li>在Cisco 29xx交换机上配置VLAN时，必须遵循以下准则：
<ol>
<li>VLAN的最大数量取决于交换机本身。</li>
<li>VLAN 1是出厂默认VLAN之一。(native VLAN往往是VLAN1，以及广播也是)</li>
<li>VLAN 1是默认的以太网VLAN。</li>
<li>思科发现协议(CDP)和VLAN骨干协议(VTP)通告在VLAN 1上发送。</li>
<li>默认情况下，Catalyst 29xx IP地址在VLAN 1广播域中。</li>
</ol>
</li>
</ol>
<h3 id="3510-vlan配置"><a class="markdownIt-Anchor" href="#3510-vlan配置"></a> 3.5.10. VLAN配置</h3>
<ol>
<li>步骤1：创建VLAN所需的步骤。 如果需要，还可以配置VLAN名称。</li>
</ol>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs autoit"><span class="hljs-keyword">Switch</span><span class="hljs-meta"># vlan database</span><br><span class="hljs-keyword">Switch</span>(vlan)<span class="hljs-meta"># vlan vlan_number</span><br><span class="hljs-keyword">Switch</span>(vlan)<span class="hljs-meta"># exit</span><br></code></pre></td></tr></table></figure>
<ol>
<li>步骤2：将VLAN分配给一个或多个接口：</li>
</ol>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">Switch(<span class="hljs-params">config</span>)</span># interface fastethernet <span class="hljs-number">0</span>/<span class="hljs-number">9</span> <span class="hljs-constructor">Switch(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># switchport access vlan vlan_number<br></code></pre></td></tr></table></figure>
<h3 id="3511-添加vlan示例"><a class="markdownIt-Anchor" href="#3511-添加vlan示例"></a> 3.5.11. 添加VLAN示例</h3>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">cat2950<span class="hljs-comment">#vlan database</span><br>cat2950(vlan)<span class="hljs-comment">#vlan 9 name switchlab90</span><br>VLAN <span class="hljs-number">9</span> added:<br>   Name: switchlab90<br>cat2950(vlan)<span class="hljs-comment">#?</span><br>VLAN database editing buffer manipulation commands:<br>    abort Exit mode without applying the changes<br>    apply Apply current changes and bump revision number<br>    <span class="hljs-keyword">exit</span> Apply changes, bump revision number, and <span class="hljs-keyword">exit</span> mode<br>    reset Abandon current changes and reread current database Adding a VLAN Example<br>cat2950(config)<span class="hljs-comment">#interface fa 0/2</span><br>cat2950(config-<span class="hljs-keyword">if</span>)<span class="hljs-comment"># switchport access vlan 9</span><br></code></pre></td></tr></table></figure>
<h3 id="3512-验证vlan"><a class="markdownIt-Anchor" href="#3512-验证vlan"></a> 3.5.12. 验证VLAN</h3>
<ol>
<li><code>Switch# show vlan [vlanid]</code></li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/33.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<blockquote>
<p>剩下的是默认VLAN</p>
</blockquote>
<h3 id="3513-删除vlan"><a class="markdownIt-Anchor" href="#3513-删除vlan"></a> 3.5.13. 删除VLAN</h3>
<ol>
<li>删除VLAN后，分配给该VLAN的所有端口都将变为非活动状态。 但是，端口将一直与删除的VLAN关联，直到分配给新的VLAN。</li>
<li><code>switch(vlan)# no vlan vlanid [name /vlan-name]</code></li>
</ol>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">cat2950</span><span class="hljs-params">(vlan)</span></span><span class="hljs-selector-id">#no</span> vlan <span class="hljs-number">9</span><br>Deleting VLAN <span class="hljs-number">9</span>...<br><span class="hljs-function"><span class="hljs-title">cat2950</span><span class="hljs-params">(vlan)</span></span><span class="hljs-selector-id">#exit</span><br>APPLY completed.<br>Exiting....<br>cat2950#<br></code></pre></td></tr></table></figure>
<h2 id="36-在局域网之间的路由"><a class="markdownIt-Anchor" href="#36-在局域网之间的路由"></a> 3.6. 在局域网之间的路由</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/34.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>每个端口连接一个VLAN，每个IP和一个VLAN连接</li>
<li>如下图，我们使用串口线，物理上是一个一个接口，划分成多个IP和子接口</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/1.jpg" srcset="/img/loading.gif" lazyload alt="" /></p>
<ul>
<li>对比如下:接入方式不同</li>
</ul>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/35.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h3 id="361-子接口"><a class="markdownIt-Anchor" href="#361-子接口"></a> 3.6.1. 子接口</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec09/36.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>物理上一个，划分成Fa0/1、Fa0/2和Fa/3</li>
<li>涉及到的是单臂路由</li>
</ol>
<h3 id="362-配置vlan间路由"><a class="markdownIt-Anchor" href="#362-配置vlan间路由"></a> 3.6.2. 配置VLAN间路由</h3>
<ol>
<li>Step1:识别界面.<code>Router(config)#interface fastethernet port-number. subinterface-number</code></li>
<li>Step2:定义VLAN封装.(一般用dot1q)<code>Router(config-if)#encapsulation dot1q vlan-number</code></li>
<li>Step3:为接口分配IP地址<br />
<code>Router(config-if)#ip address ip-address subnet-mask</code></li>
</ol>
<h3 id="363-配置vlan间路由"><a class="markdownIt-Anchor" href="#363-配置vlan间路由"></a> 3.6.3. 配置VLAN间路由</h3>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#interface</span> FastEthernet <span class="hljs-number">0</span>/<span class="hljs-number">0</span> <br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#full</span> duplex 全双工<br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#no</span> shut<br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#interface</span> FastEthernet <span class="hljs-number">0</span>/<span class="hljs-number">0.1</span><br><br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> <span class="hljs-number">802.1</span>q <span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> <span class="hljs-selector-tag">address</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#interface</span> FastEthernet <span class="hljs-number">0</span>/<span class="hljs-number">0.2</span><br><br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> <span class="hljs-number">802.1</span>q <span class="hljs-number">20</span><br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> <span class="hljs-selector-tag">address</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">2.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#interface</span> FastEthernet <span class="hljs-number">0</span>/<span class="hljs-number">0.3</span><br><br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> <span class="hljs-number">802.1</span>q <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">Sydney</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> <span class="hljs-selector-tag">address</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">3.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br></code></pre></td></tr></table></figure>
<ol>
<li>如果是Trunk Link:应该使用交叉线，而不是直通线</li>
<li>如果是Access Link:直通线</li>
</ol>
<h1 id="4-vlan题目备注"><a class="markdownIt-Anchor" href="#4-vlan题目备注"></a> 4. VLAN题目备注</h1>
<ol>
<li>同一VLAN中的两台主机可以跨越多台交换机</li>
<li>必须是第三层及以上的交换机才能用来构建VLAN</li>
</ol>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/2020-%E4%BA%92%E8%81%94%E7%BD%91%E8%AE%A1%E7%AE%97/" class="category-chain-item">2020-互联网计算</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">#课程笔记</a>
      
        <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">#计算机网络</a>
      
        <a href="/tags/%E5%B1%80%E5%9F%9F%E7%BD%91/">#局域网</a>
      
        <a href="/tags/%E4%BA%A4%E6%8D%A2%E6%9C%BA/">#交换机</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2020-计算机网络-lecture09-局域网交换与VLAN</div>
      <div>https://spricoder.github.io/2020/07/05/2020-Internet-computing/2020-Internet-computing-lecture09-%E5%B1%80%E5%9F%9F%E7%BD%91%E4%BA%A4%E6%8D%A2%E4%B8%8EVLAN/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>SpriCoder</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2020年7月5日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/07/05/2020-Internet-computing/2020-Internet-computing-lecture10-WANs/" title="2020-计算机网络-lecture10-WANs">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">2020-计算机网络-lecture10-WANs</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/07/05/2020-Internet-computing/2020-Internet-computing-lecture08-Routing%20Protocols/" title="2020-计算机网络-lecture08-Routing Protocols">
                        <span class="hidden-mobile">2020-计算机网络-lecture08-Routing Protocols</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'SpriCoder/spricoder-blog-comment');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  <!-- <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      京ICP证123456号
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
          
          <span>京公网安备12345678号</span>
        </a>
      </span>
    
  
</div>
 -->
  
</footer>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  
    <script  src="/js/img-lazyload.js" ></script>
  



  <script  src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var title = subtitle.title;
      
        typing(title);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  





  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
