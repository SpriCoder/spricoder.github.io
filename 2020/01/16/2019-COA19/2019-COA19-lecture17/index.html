

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="SpriCoder">
  <meta name="keywords" content="">
  
    <meta name="description" content="2019-计算机组织与结构-lecture17">
<meta property="og:type" content="article">
<meta property="og:title" content="2019-计算机组织与结构-lecture17">
<meta property="og:url" content="https://spricoder.github.io/2020/01/16/2019-COA19/2019-COA19-lecture17/index.html">
<meta property="og:site_name" content="SpriCoder的博客">
<meta property="og:description" content="2019-计算机组织与结构-lecture17">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/1.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/2.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/3.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/4.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/5.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/6.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/7.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/8.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/9.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/10.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/11.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/12.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/13.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/14.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/15.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/16.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/17.png">
<meta property="og:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/18.png">
<meta property="article:published_time" content="2020-01-16T11:17:00.000Z">
<meta property="article:modified_time" content="2022-03-07T10:33:11.604Z">
<meta property="article:author" content="SpriCoder">
<meta property="article:tag" content="课程笔记">
<meta property="article:tag" content="COA">
<meta property="article:tag" content="模块">
<meta property="article:tag" content="处理器">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/1.png">
  
  
  <title>2019-计算机组织与结构-lecture17 - SpriCoder的博客</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://cdn.staticfile.org/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"spricoder.github.io","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"DYxfU2PHurs2yXd95Sq85bU2-gzGzoHsz","app_key":"YWKSJ5KaDC4GQh2F8JraQPBr","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>

  
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>SpriCoder的博客</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/website.jpg') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          <span id="subtitle" title="2019-计算机组织与结构-lecture17">
            
          </span>
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2020-01-16 19:17" pubdate>
          2020年1月16日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          14k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          119 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">2019-计算机组织与结构-lecture17</h1>
            
            <div class="markdown-body">
              
              <h2 id="input-output"><a class="markdownIt-Anchor" href="#input-output"></a> Input / Output</h2>
<h1 id="1-peripheral-device外部设备外设"><a class="markdownIt-Anchor" href="#1-peripheral-device外部设备外设"></a> 1. Peripheral Device(外部设备，外设)</h1>
<ol>
<li>I/O operations are accomplished through a wide assortment of external devices that provide a means of exchanging data between the external environment and the computer(I/O操作是通过各种各样的外部设备来完成的，这些外部设备提供了一种在外部环境和计算机之间交换数据的方法)</li>
<li>An external device connected to an I/O module is often referred to as a peripheral device or, simply, a peripheral(连接到I/O模块的外部设备通常被称为外围设备，或者简单地说，外围设备)</li>
<li>Type
<ol>
<li>Human readable: communicate with the computer user(可读性：与计算机用户通信)</li>
<li>Video display terminal, printer, ……(视频显示终端，打印机，)</li>
<li>Machine readable: communicate with equipment(机器可读：与设备通信)</li>
<li>Disk, tape, …… (磁盘、磁带……)</li>
<li>Communication: communicate with remote devices(通信：与远程设备通信)</li>
</ol>
</li>
</ol>
<h1 id="2-why-not-connect-io-device-to-bus-为什么不直接把io模块连接到总线"><a class="markdownIt-Anchor" href="#2-why-not-connect-io-device-to-bus-为什么不直接把io模块连接到总线"></a> 2. Why NOT Connect I/O Device To Bus 为什么不直接把I/O模块连接到总线</h1>
<ol>
<li>There are a wide variety of peripherals with various methods of operation(外设种类繁多，操作方法多种多样)</li>
<li>The data transfer rate of peripherals is often much slower than that of the memory or processor(外设的数据传输速率通常比存储器或处理器的数据传输速率慢得多)</li>
<li>The data transfer rate of some peripherals is faster than that of the memory or processor(有些外设的数据传输速率比内存或处理器的快)</li>
<li>Peripherals often use different data formats and word lengths than the computer to which they are attached 外设通常使用不同的数据格式和字长，而不是它们所连接的计算机</li>
</ol>
<h1 id="3-io-module-io模块"><a class="markdownIt-Anchor" href="#3-io-module-io模块"></a> 3. I/O Module I/O模块</h1>
<ol>
<li>Interface to the processor and memory via the system bus or central switch(通过系统总线或中央开关与处理器和存储器的接口)</li>
<li>Interface to one or more peripheral devices by tailored data links(通过定制的数据链路连接到一个或多个外围设备)</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/1.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="3">
<li><strong>I/O Module</strong> is a bridge between <strong>internal system</strong> and <strong>peripherals</strong>
<ul>
<li>键盘不是I/O模块，插入的部分是I/O模块</li>
</ul>
</li>
</ol>
<h2 id="31-interface-to-peripheral-到外部设备的接口"><a class="markdownIt-Anchor" href="#31-interface-to-peripheral-到外部设备的接口"></a> 3.1. Interface to Peripheral 到外部设备的接口</h2>
<ol>
<li>The interface to the I/O module is in the form of control, data, and status signals I/O模块的接口以控制、数据和状态信号的形式</li>
<li>Control logic associated with the device controls the device’s operation in response to direction from the I/O module 与设备相关联的控制逻辑根据来自输入/输出模块的方向控制设备的操作</li>
<li>Buffer is associated with the transducer to temporarily hold data being transferred between the I/O module and the external environment with size of 8 to 16 bits 缓冲器与传感器相关联，用于临时保存在输入/输出模块和外部环境之间传输的8至16位数据</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/2.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="4">
<li>状态是外设告知计算机的，控制信号是计算机给外设的，数据可以是双方交互的。</li>
</ol>
<h2 id="32-io-module-functions-io模块的作用"><a class="markdownIt-Anchor" href="#32-io-module-functions-io模块的作用"></a> 3.2. I/O Module Functions I/O模块的作用</h2>
<h3 id="321-processor-communication-处理器交互"><a class="markdownIt-Anchor" href="#321-processor-communication-处理器交互"></a> 3.2.1. Processor communication 处理器交互</h3>
<ol>
<li>Command decoding: I/O module accepts commands from the processor, typically sent as signals on the control bus 命令解码：I/O模块接受来自处理器的命令，通常作为控制总线上的信号发送</li>
<li>Data: data are exchanged between processor and I/O module over data bus 数据：数据通过数据总线在处理器和I/O模块之间交换</li>
<li>Status reporting: for peripherals are so slow, it is important to know the status of the I/O module 状态报告：对于速度非常慢的外围设备，了解I/O模块的状态非常重要</li>
<li>Address recognition: I/O module must recognize one unique address for each peripheral it controls 地址识别：I/O模块必须为其控制的每个外围设备识别一个唯一的地址</li>
</ol>
<h3 id="322-device-communication-设备交互"><a class="markdownIt-Anchor" href="#322-device-communication-设备交互"></a> 3.2.2. Device communication 设备交互</h3>
<blockquote>
<p>涉及以下三种</p>
</blockquote>
<ol>
<li>commands 命令</li>
<li>status information 状态信息</li>
<li>data 数据</li>
</ol>
<h3 id="323-control-and-timing-控制和定时"><a class="markdownIt-Anchor" href="#323-control-and-timing-控制和定时"></a> 3.2.3. Control and timing 控制和定时</h3>
<ol>
<li>Processor communicates with external devices in unpredictable patterns 处理器以不可被预知的模式与外部设备通信</li>
<li>Internal resources, such as memory and system bus, are shared 内存和系统总线等内部资源是共享的</li>
<li>Example: transfer of data from external device to processor 示例：将数据从外部设备传输到处理器
<ol>
<li>Processor interrogates I/O module to check the device status 处理器询问I/O模块以检查设备状态</li>
<li>I/O module returns the device status I/O模块返回设备状态</li>
<li>If prepared, processor requests the transfer of data, by means of a command to I/O module 如果准备好了，处理器通过命令向I/O模块请求数据传输</li>
<li>I/O module obtains a unit of data from the external device I/O模块从外部设备获取数据单位</li>
<li>Data are transferred from I/O module to processor 数据从I/O模块传输到处理器</li>
</ol>
</li>
</ol>
<h3 id="324-data-buffering-数据缓冲"><a class="markdownIt-Anchor" href="#324-data-buffering-数据缓冲"></a> 3.2.4. Data buffering 数据缓冲</h3>
<ol>
<li>Transfer rate into and out of main memory or processor is quite high 进出主存或处理器的传输速率相当高</li>
<li>Transfer rate is orders of magnitude lower for many peripheral devices and covers a wide range 对于许多外围设备来说，传输速率要低几个数量级，而且覆盖范围很广</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/3.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h3 id="325-error-detection-错误探测"><a class="markdownIt-Anchor" href="#325-error-detection-错误探测"></a> 3.2.5. Error detection 错误探测</h3>
<ol>
<li>Detect errors and report errors to processor 检查错误，并且报告错误给处理器</li>
<li>Error type 错误类型
<ol>
<li>Mechanical and electrical malfunctions reported by the device 设备报告的机械和电气故障(硬件错误)</li>
<li>Unintentional changes to the bit pattern in transfer 传输中对位模式的无意更改(就是奇偶校验法校验的位)</li>
</ol>
</li>
</ol>
<h1 id="4-io-module-structure"><a class="markdownIt-Anchor" href="#4-io-module-structure"></a> 4. I/O Module Structure</h1>
<ol>
<li>红色的是对计算机系统内部的接口</li>
<li>蓝色的是对计算机系统外部的接口</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/4.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="3">
<li>registers表示不止一个，超过一个。</li>
<li>状态/控制寄存器是放置磁道多少、读多少等信息(一些参数的存储)</li>
</ol>
<h2 id="41-external-interface-外部接口"><a class="markdownIt-Anchor" href="#41-external-interface-外部接口"></a> 4.1. External Interface 外部接口</h2>
<ol>
<li>For parallel interface requires timing on each time, the bus clock frequency is limited when the transfer speed and bus length increase 由于并行接口要求每次定时，当传输速度和总线长度增加时，总线时钟频率受到限制</li>
<li>如果总线长度增加，那么在总线上的传输时间就不可以被忽略，所以会造成总线频率震动</li>
</ol>
<h3 id="411-并行接口-parallel-interface"><a class="markdownIt-Anchor" href="#411-并行接口-parallel-interface"></a> 4.1.1. 并行接口 Parallel interface:</h3>
<ol>
<li>there are multiple lines connecting I/O module and the peripheral, and multiple bits are transferred simultaneously, just as all of the bits of a word are transferred simultaneously over the data bus 有多条线路连接I/O模块和外围设备，同时传输多个位，就像一个字的所有位通过数据总线同时传输一样</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/5.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h3 id="412-串行接口-serial-interface"><a class="markdownIt-Anchor" href="#412-串行接口-serial-interface"></a> 4.1.2. 串行接口 Serial interface:</h3>
<ol>
<li>there is only one line used to transmit data, and bits must be transmitted one at a time 只有一条线路用于传输数据，每次必须传输一个位</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/6.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="2">
<li>为什么目前多用<strong>串行总线</strong>？
<ol>
<li>并行总线对于时钟要求高，并且数据线长度不能太长。时钟漂移(时间对不齐会出问题)带来问题</li>
<li>便宜:如果使用并行总线，那么每根线之间需要防止串线。</li>
</ol>
</li>
</ol>
<h1 id="5-io-operation-technique-io-操作技术"><a class="markdownIt-Anchor" href="#5-io-operation-technique-io-操作技术"></a> 5. I/O Operation Technique I/O 操作技术</h1>
<ol>
<li>Programmed I/O(编程式): when transfer data, processor executes a program that gives it direct control of the I/O operation, and wait until the I/O operation is complete 当传输数据时，处理器执行一个程序，该程序直接控制I/O操作，并等待I/O操作完成</li>
<li>Interrupt-driven I/O(中断驱动式): processor issues an I/O command, continues to execute other instructions, and is interrupted by the I/O module when the latter has completed its work 处理器发出一个I/O命令，继续执行其他指令，当I/O模块完成工作时中断</li>
<li>Direct memory access(DMA): I/O module and main memory exchange data directly, without processor involvement I/O模块和主存直接交换数据，无需处理器参与</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/7.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h2 id="51-programmed-io-编程式-io"><a class="markdownIt-Anchor" href="#51-programmed-io-编程式-io"></a> 5.1. Programmed I/O 编程式 I/O</h2>
<ol>
<li>When processor is executing a program and encounters an instruction relating to I/O, it executes that instruction by issuing a command to the appropriate I/O module 当处理器执行一个程序并遇到一个与I/O有关的指令时，它通过向适当的I/O模块发出一个命令来执行该指令</li>
<li>I/O module will perform the requested action and then set the appropriate bits in the I/O status register I/O模块将执行请求的操作，然后在I/O状态寄存器中设置适当的位</li>
<li>I/O module does not interrupt processor, so it is the responsibility of processor periodically to check the status of I/O module until it finds that the operation is complete I/O模块不会中断处理器，因此处理器有责任定期检查I/O模块的状态，直到发现操作完成为止</li>
<li>是I/O处理部分中唯一不产生中断的部分</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/8.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="4">
<li>Check Status表示确认状态
<ol>
<li>一个是为未准备好</li>
<li>另一个是出现了其他错误</li>
</ol>
</li>
<li>问题:只要有I/O操作，cpu就<strong>一直要忙</strong>，过程参考右侧小字
<ul>
<li>也就是意味着I/O占用率会比较高</li>
</ul>
</li>
</ol>
<h3 id="511-io-command-io命令"><a class="markdownIt-Anchor" href="#511-io-command-io命令"></a> 5.1.1. I/O Command I/O命令</h3>
<ol>
<li>To execute an I/O-related instruction, the processor issues an address, specifying the particular I/O module and external device, and an I/O command 为了执行与I/O相关的指令，处理器发出一个地址，指定特定的I/O模块和外部设备，以及一个I/O命令</li>
<li>Type
<ol>
<li>Control: activate a peripheral and tell it what to do 控制：激活外设并告诉它该做什么</li>
<li>Test: test various status conditions associated with an I/O module and its peripherals 测试：测试与I/O模块及其外围设备相关的各种状态条件</li>
<li>Read: cause I/O module to obtain an item of data from the peripheral and place it in an internal buffer 读取：使I/O模块从外设获取一项数据并将其放入内部缓冲区</li>
<li>Write: cause the I/O module to take an item of data from the data bus and subsequently transmit that data item to the peripheral 写入：使I/O模块从数据总线获取一项数据，然后将该数据项传输到外围设备</li>
</ol>
</li>
</ol>
<h3 id="512-io-instruction-io指令"><a class="markdownIt-Anchor" href="#512-io-instruction-io指令"></a> 5.1.2. I/O Instruction I/O指令</h3>
<ol>
<li>I/O instructions are easily mapped into I/O commands, and there is often a simple one-to-one relationship I/O指令很容易映射到I/O命令中，并且通常有一个简单的一对一关系
<ul>
<li>The form of the instruction depends on the way in which external devices are addressed 指令的形式取决于外部设备的寻址方式</li>
</ul>
</li>
<li>Addressing
<ol>
<li>Memory-mapped I/O: a single address space for memory locations and I/O devices 内存映射I/O：用于内存位置和I/O设备的单个地址空间
<ul>
<li>Large repertoire of instructions can be used, allowing more efficient programming 可以使用大量指令，从而实现更高效的编程</li>
<li>坏处:这样子牺牲了一部分的内存空间</li>
</ul>
</li>
<li>Isolated I/O: equipped with memory read and write plus input and output command lines 隔离I/O：配备存储器读写和输入输出命令行
<ul>
<li>使用一些比较专用的命令</li>
</ul>
</li>
</ol>
</li>
<li><strong>和I/O相关的指令是I/O指令，I/O命令一般对应一个I/O指令，I/O命令比I/O指令少一个地址</strong></li>
</ol>
<h2 id="52-interrupt-driven-io-中断驱动式的io"><a class="markdownIt-Anchor" href="#52-interrupt-driven-io-中断驱动式的io"></a> 5.2. Interrupt Driven I/O 中断驱动式的I/O</h2>
<ol>
<li>Processor issues an I/O command to a module and then go on to do some other useful work 处理器向一个模块发出一个I/O命令，然后继续做一些其他有用的工作</li>
<li>I/O module interrupts the processor to request service, when it is ready to exchange data with the processor 当处理器准备好与处理器交换数据时，I/O模块中断处理器以请求服务</li>
<li>Processor executes data transfer, and then resumes its former processing 处理器执行数据传输，然后恢复以前的处理</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/9.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="4">
<li>注意右侧小字:可以发现cpu可以去做一些其他的事情。</li>
</ol>
<h3 id="521-view-point-of-io-module-从io模块看"><a class="markdownIt-Anchor" href="#521-view-point-of-io-module-从io模块看"></a> 5.2.1. View point of I/O module 从I/O模块看</h3>
<ol>
<li>For input, I/O module receives a READ command from the processor 对于输入，I/O模块从处理器中接收到读命令。</li>
<li>I/O module proceeds to read data in from an associated peripheral I/O模块继续从相关外围设备读取数据。</li>
<li>Once the data are in the module’s data register, I/O module signals an interrupt to the processor over a control line 一旦数据进入模块的数据寄存器，I/O模块通过控制线向处理器发送<strong>中断信号</strong></li>
<li>I/O module waits until its data are requested by the processor I/O模块等待处理器请求其数据</li>
<li>When the request is made, I/O module places its data on the data bus and is then ready for another I/O operation 当发出请求时，I/O模块将其数据放在数据总线上，然后准备进行另一个I/O操作</li>
</ol>
<h3 id="522-view-point-of-processor-从处理器角度"><a class="markdownIt-Anchor" href="#522-view-point-of-processor-从处理器角度"></a> 5.2.2. View point of processor 从处理器角度</h3>
<ol>
<li>Processor issues a READ command 处理器发出读取命令</li>
<li>Processor goes off and does something else, and checks for interrupts at the end of each instruction cycle 处理器关闭并执行其他操作，并在每个指令周期结束时检查中断</li>
<li>When the interrupt from I/O module occurs, processor saves the context of the current program 当I/O模块发生中断时，<strong>处理器保存当前程序的上下文</strong></li>
<li>Processor reads the word of data from I/O module and stores it in memory 处理器从I/O模块读取数据字并将其存储在存储器中</li>
<li>Processor restores the context of the program it was working on (or some other program) and resumes execution 处理器恢复正在运行的程序(或其他程序)的上下文并继续执行</li>
</ol>
<h3 id="523-device-identification-设备确认"><a class="markdownIt-Anchor" href="#523-device-identification-设备确认"></a> 5.2.3. Device Identification 设备确认</h3>
<ol>
<li>Multiple interrupt lines 多条中断线
<ul>
<li>Even if multiple lines are used, one of the other three techniques must be used on each line 即使使用多行，也必须在每行上使用其他三种技术之一</li>
</ul>
</li>
<li>Software poll 软件轮询
<ul>
<li>Processor checks the address of each I/O module in turn 处理器依次检查每个I/O模块的地址</li>
</ul>
</li>
<li>Daisy chain (vectored interrupt) 链式(向量中断):向量表示的是这个硬件设备的编号
<ul>
<li>All I/O modules share a common interrupt request line, and the interrupt acknowledge line is daisy chained through the modules 所有I/O模块共享一条公共中断请求线，中断确认线通过模块菊花链连接，许可的方式</li>
<li><strong>为什么不可以直接报号?因为一个时刻可能不止一个设备在请求</strong>:也就是意味着存在多个设备抢总线的情况</li>
</ul>
</li>
<li>Independent request (vectored interrupt)独立请求 向量中断
<ul>
<li>A specific interrupt controller is used to analyze priorities and decoding 一个特定的<strong>中断控制器</strong>来分析优先级和解码，也就是增加了运算量的问题。</li>
<li>依旧也会涉及到向量(编号)</li>
</ul>
</li>
</ol>
<h3 id="524-assigning-priority-优先级问题"><a class="markdownIt-Anchor" href="#524-assigning-priority-优先级问题"></a> 5.2.4. Assigning Priority 优先级问题</h3>
<ol>
<li>Multiple interrupt lines: processor picks the interrupt line with the highest priority 多中断线：处理器选择优先级最高的中断线</li>
<li>Software poll: the order in which modules are polled determines their priority 软件轮询:模块的轮询顺序决定了它们的优先级</li>
<li>Daisy chain: the order of modules determines their priority 菊花链:模块的顺序决定了它们的优先级</li>
<li>Independent request : the interrupt controller determines 独立请求:由控制器决定谁进行中断。</li>
<li>设置两个优先级来进行处理:<strong>响应优先级、处理优先级</strong>
<ul>
<li>防止有比较严重的情况</li>
<li>我们要这么理解响应优先级和处理优先级:也就是说我们不得不注意到，永远是响应优先级高的优先占用到总线，之后是根据是否有处理优先级更高的部分需要被处理来决定是否优先处理另一部分。</li>
</ul>
</li>
</ol>
<h3 id="525-interrupts-enabled-and-disabled开关中断"><a class="markdownIt-Anchor" href="#525-interrupts-enabled-and-disabled开关中断"></a> 5.2.5. Interrupts Enabled and Disabled(开关中断)</h3>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/10.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol>
<li>为什么要有从Execute instruction到前面的箭头?
<ul>
<li>因为有开关中断:也就是说这个时候的终端未必可以被响应</li>
</ul>
</li>
<li>中断要把所有的上下文环境放置到栈中。</li>
<li>为什么会有开关中断?
<ul>
<li>因为有些操作不可以被打断，比如绿字中的部分不可以被关闭:比如有些正在处理中关于数据读取等操作不可以被直接打断。</li>
</ul>
</li>
</ol>
<h3 id="526-response-priority-and-processing-priority-响应优先级以及处理优先级"><a class="markdownIt-Anchor" href="#526-response-priority-and-processing-priority-响应优先级以及处理优先级"></a> 5.2.6. Response Priority and Processing Priority 响应优先级以及处理优先级</h3>
<ol>
<li>例子如下：</li>
<li>Assume there are 4 interrupt sources in an interrupt system, whose <strong>response priorities</strong> are L1&gt;L2&gt;L3&gt;L4 and <strong>processing priorities</strong> are L1&gt;L4&gt;L3&gt;L2. If the L1, L3 and L4 interrupts occur at the same time when the main program executes, and L2 interrupt occurs in the procedure of processing L3 interrupt, write the <strong>mask words(屏蔽字)</strong> and the procedure of all interrupt service programs. 我们假设在中断系统中一共有4种终端设备，他们的响应优先级为L1&gt;L2&gt;L3&gt;L4，并且处理优先级为L1&gt;L4&gt;L3&gt;L2,假设L1、L3、L4在主程序运行的时候同时发生了中断请求，而L2的中断请求发生在处理L3中断的时候，请写出当前中断处理程序的过程以及屏蔽字。</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/11.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="3">
<li>屏蔽字是由处理优先级来进行处理的
<ul>
<li>每一个都能屏蔽自己:因为处理优先级不高所以可以屏蔽自己</li>
<li>如上的屏蔽字中，行屏蔽列</li>
</ul>
</li>
<li>例子:抢座位，年轻人先抢到<strong>坐下</strong>(响应优先级高),老太太比较慢(响应优先级低)，但是处理优先级高，所以年轻人会站起来，把座位留给老太太
<ul>
<li>所以年轻人代表的程序段在栈中留下了痕迹，意味着这部分程序段并没有出栈，而仅仅是在栈中还没被处理</li>
</ul>
</li>
<li>第二个原则:从哪里来到哪里去，先回到主程序。</li>
<li>考试的话:要写好每一个步骤，算分从第一个错误的开始算。</li>
</ol>
<h1 id="6-direct-memory-access-直接内存访问"><a class="markdownIt-Anchor" href="#6-direct-memory-access-直接内存访问"></a> 6. Direct Memory Access 直接内存访问</h1>
<ol>
<li>DMA的初始化比较耗时，因为需要获知具体的操作信息。</li>
</ol>
<h2 id="61-problem-dma存在的问题"><a class="markdownIt-Anchor" href="#61-problem-dma存在的问题"></a> 6.1. problem DMA存在的问题</h2>
<ol>
<li>I/O transfer rate is limited by the speed with which processor can test and service a device I/O传输速率受处理器测试和服务设备的速度限制</li>
<li>Processor is tied up in managing an I/O transfer; a number of instructions must be executed for each I/O transfer 处理器在管理I/O传输时被束缚；每个I/O传输都必须执行许多指令</li>
</ol>
<h2 id="62-dma"><a class="markdownIt-Anchor" href="#62-dma"></a> 6.2. DMA</h2>
<ol>
<li>A module for direct memory access without going through processor 一种不经过处理器直接存取存储器的模块</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/12.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="2">
<li>Processor issues a command to the DMA module by sending the following information: read/write, I/O device address, starting location in memory, number of words 处理器通过发送以下信息向DMA模块发出命令：读/写、I/O设备地址、内存中的起始位置、字数</li>
<li>Processor continues with other work 处理器继续其他工作，从而保证了处理器可以被相对更少的占用。</li>
<li>DMA module transfers the entire block of data, one word at a time, directly to or from memory, without going through processor DMA模块在不经过处理器的情况下，将<strong>整个数据块一次一个字</strong>直接传送到存储器或从存储器中传送出去</li>
<li>When the transfer is complete, DMA module sends an interrupt signal to processor 当传输完成时，DMA模块向处理器发送一个中断信号</li>
<li>在这个过程中，CPU和DMA会访问内存，这时候会出现冲突。CPU和DMA发生冲突时，<strong>DMA优先级高</strong>
<ul>
<li>因为DMA连接的是比较高速的I/O设备，如果不及时相应，则容易<strong>数据溢出</strong>。</li>
</ul>
</li>
</ol>
<h2 id="63-memory-access-内存权限"><a class="markdownIt-Anchor" href="#63-memory-access-内存权限"></a> 6.3. Memory Access 内存权限</h2>
<h3 id="631-stop-cpu-停止cpu"><a class="markdownIt-Anchor" href="#631-stop-cpu-停止cpu"></a> 6.3.1. Stop CPU 停止CPU</h3>
<ol>
<li>Advantage: simple in control 控制简单</li>
<li>Disadvantage: influence CPU, not make full use of memory 影响CPU，对于内存的使用不充分</li>
<li>Suitable: block transfer by high speed I/O device 高速I/O设备的块传输</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/13.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="4">
<li>这种情况不常用:他是直接停止了CPU对于其他部分的处理</li>
</ol>
<h3 id="632-cycle-stealing-周期窃取"><a class="markdownIt-Anchor" href="#632-cycle-stealing-周期窃取"></a> 6.3.2. Cycle stealing 周期窃取</h3>
<ol>
<li>Advantage: make full use of CPU and memory, and response I/O request in time 充分利用CPU和内存，及时响应I/O请求</li>
<li>Disadvantage: DMA should request bus each time DMA应每次请求总线</li>
<li>Suitable: I/O cycle is larger than memory cycle <strong>I/O周期大于内存周期</strong></li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/14.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="4">
<li>CPU用着，DMA使用则进行使用</li>
</ol>
<h3 id="633-alternate-time-sharing-access-共享权限"><a class="markdownIt-Anchor" href="#633-alternate-time-sharing-access-共享权限"></a> 6.3.3. Alternate (time sharing) access 共享权限</h3>
<ol>
<li>Advantage: CPU is not stopped or waited, and DMA doesn’t request bus CPU未停止或等待，DMA未请求总线</li>
<li>Suitable: CPU cycle is larger than memory cycle 适用：<strong>CPU周期大于内存周期</strong></li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/15.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="3">
<li>这种情况比较少:简单来看就是讲一个时钟周期加细。</li>
</ol>
<h2 id="64-connection-连接"><a class="markdownIt-Anchor" href="#64-connection-连接"></a> 6.4. Connection 连接</h2>
<h3 id="641-dma-mechanism-configuration-dma机制配置"><a class="markdownIt-Anchor" href="#641-dma-mechanism-configuration-dma机制配置"></a> 6.4.1. DMA mechanism configuration DMA机制配置</h3>
<ol>
<li>Single-bus, detached DMA 一条总线，连接DMA
<ul>
<li>All modules share the same system bus 所有模块共享同一系统总线</li>
<li>DMA module uses programmed I/O to exchange data between memory and an I/O module through DMA module DMA模块使用编程的I/O通过DMA模块在存储器和I/O模块之间交换数据</li>
<li>Inexpensive but inefficient 便宜但是低效</li>
</ul>
</li>
<li>Single-bus, integrated DMA-I/O 一条总线，整合了DMA和I/O
<ul>
<li>Besides system bus, there is a path between DMA module and one or more I/O modules 除了系统总线外，DMA模块和一个或多个I/O模块之间还有一条路径</li>
<li>DMA logic may actually be a part of an I/O module, or it may be a separate module that controls one or more I/O modules DMA逻辑实际上可以是I/O模块的一部分，也可以是控制一个或多个I/O模块的单独模块</li>
<li>Reduce the bus cycles 减少循环周期</li>
</ul>
</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/16.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="3">
<li>I/O bus 使用I/O总线
<ul>
<li>Connect I/O modules to the DMA module using an I/O bus 使用I/O总线将I/O模块连接到DMA模块</li>
<li>Reduce the number of I/O interfaces in DMA module to one and provides for an easily expandable configuration 将DMA模块中的I/O接口数量减少到1个，并提供易于扩展的配置</li>
</ul>
</li>
</ol>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/17.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<ol start="4">
<li>Example
<ol>
<li>Assume the clock frequency of CPU is 500MHz; hard disk transfers data with 4 words block (32 bits per words), and the transfer speed is 32Mbps 假设CPU的时钟频率为500MHz，硬盘以4字块(32位/字)传输数据，传输速度为32Mbps</li>
<li>If use interrupt driven I/O, each block transfer requires 500 clock cycles (including interrupt response and processing), what the time percentage does CPU use in hard disk I/O? 如果使用中断驱动的I/O，每个块传输需要500个时钟周期(包括中断响应和处理)，CPU在硬盘I/O中使用的时间百分比是多少？
<ul>
<li>Interrupt number per second: 32Mb(32,000,000b) / 16B(128b) = 250K</li>
<li>Cycle number per second: 250K * 500 = 125M</li>
<li>CPU time percentage: 125M / 500M = 25%</li>
</ul>
</li>
<li>If use DMA, CPU requires 1000 clock cycles for DMA transfer initialization, and 500 clock cycles for interrupt processing after transfer. If 8KB data can be transferred in each DMA transfer, what the time percentage does CPU use in hard disk I/O? 如果使用DMA，CPU需要1000个时钟周期用于DMA传输初始化，500个时钟周期用于传输后的中断处理。如果在每次DMA传输中可以传输8KB数据，那么CPU在硬盘I/O中使用的时间百分比是多少？
<ul>
<li>Time for each DMA transfer: 8KB / 32Mbps = 2ms</li>
<li>DMA transfer number per second: 1s / 2ms = 500</li>
<li>Cycle number per second: (1000 + 500) * 500 = 750K</li>
<li>CPU time percentage: 750K / 500M = 0.15%</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2 id="65-hard-disk-access"><a class="markdownIt-Anchor" href="#65-hard-disk-access"></a> 6.5. Hard Disk Access</h2>
<p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2019-COA19/img/cpt17/18.png" srcset="/img/loading.gif" lazyload alt="" /></p>
<h1 id="7-evolutionary-of-io-module-io-模块的发展进程"><a class="markdownIt-Anchor" href="#7-evolutionary-of-io-module-io-模块的发展进程"></a> 7. Evolutionary of I/O Module I/O 模块的发展进程</h1>
<ol>
<li>CPU directly controls a peripheral device(最开始 CPU 直接控制了外设)</li>
<li>A controller or I/O module is added, and CPU uses programmed I/O without interrupts (divorce CPU from external device details) 添加了控制器或I/O模块，CPU使用编程的I/O而不中断(CPU与外部设备细节分离)</li>
<li>Interrupts are employed (CPU need not spend time waiting for an I/O operation to be performed) 使用中断(CPU无需花费时间等待执行I/O操作)</li>
<li>I/O module is given direct access to memory via DMA (move a block of data to or from memory without involving the CPU, except at the beginning and end of the transfer) I/O模块可以通过DMA直接访问内存(在不涉及CPU的情况下将数据块移动到内存或从内存中移动数据块，传输的开始和结束时除外)</li>
<li><strong>I/O channel(I/O 通道)</strong>: I/O module has its own processor, with a specialized instruction set tailored for I/O (CPU directs I/O processor to execute an I/O program in memory, and it is interrupted only when the entire sequence has been performed) I/O模块有自己的处理器，有专门为I/O定制的指令集(CPU指示I/O处理器在内存中执行I/O程序，只有在执行了整个序列时才会中断)
<ul>
<li>多了processor</li>
</ul>
</li>
<li><strong>I/O processor(I/O 处理机)</strong>: I/O module has a local memory (a large set of I/O devices can be controlled, with minimal CPU involvement) I/O模块有一个本地存储器(可以控制一大组I/O设备，只需占用很少的CPU)
<ul>
<li>多了内存</li>
</ul>
</li>
</ol>

              
            </div>
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/2019-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E4%B8%8E%E7%BB%93%E6%9E%84/" class="category-chain-item">2019-计算机组成与结构</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">#课程笔记</a>
      
        <a href="/tags/COA/">#COA</a>
      
        <a href="/tags/%E6%A8%A1%E5%9D%97/">#模块</a>
      
        <a href="/tags/%E5%A4%84%E7%90%86%E5%99%A8/">#处理器</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>2019-计算机组织与结构-lecture17</div>
      <div>https://spricoder.github.io/2020/01/16/2019-COA19/2019-COA19-lecture17/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>SpriCoder</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2020年1月16日</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>许可协议</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - 署名">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/01/17/2019-Data-Structure/2019-Data-Structure-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%841-%E7%BB%AA%E8%AE%BA/" title="2019-数据结构-数据结构1-绪论">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">2019-数据结构-数据结构1-绪论</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/01/16/2019-COA19/2019-COA19-lecture16/" title="2019-计算机组织与结构-lecture16">
                        <span class="hidden-mobile">2019-计算机组织与结构-lecture16</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'SpriCoder/spricoder-blog-comment');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  






    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <div> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
  </div>
  <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        总访问量 
        <span id="leancloud-site-pv"></span>
         次
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        总访客数 
        <span id="leancloud-site-uv"></span>
         人
      </span>
    
    

  
</div>

  <!-- <div class="beian">
  <span>
    <a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">
      京ICP证123456号
    </a>
  </span>
  
    
      <span>
        <a
          href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
          rel="nofollow noopener"
          class="beian-police"
          target="_blank"
        >
          
            <span style="visibility: hidden; width: 0">|</span>
            <img src="/img/police_beian.png" srcset="/img/loading.gif" lazyload alt="police-icon"/>
          
          <span>京公网安备12345678号</span>
        </a>
      </span>
    
  
</div>
 -->
  
</footer>
  </footer>

  <!-- Scripts -->
  
  <script  src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.staticfile.org/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  
    <script  src="/js/img-lazyload.js" ></script>
  



  <script  src="https://cdn.staticfile.org/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var title = subtitle.title;
      
        typing(title);
      
    })(window, document);
  </script>




  

  

  

  

  

  

  





  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/tocbot/4.18.0/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script>
  (function() {
    var enableLang = CONFIG.code_language.enable && CONFIG.code_language.default;
    var enableCopy = CONFIG.copy_btn;
    if (!enableLang && !enableCopy) {
      return;
    }

    function getBgClass(ele) {
      return Fluid.utils.getBackgroundLightness(ele) >= 0 ? 'code-widget-light' : 'code-widget-dark';
    }

    var copyTmpl = '';
    copyTmpl += '<div class="code-widget">';
    copyTmpl += 'LANG';
    copyTmpl += '</div>';
    jQuery('.markdown-body pre').each(function() {
      var $pre = jQuery(this);
      if ($pre.find('code.mermaid').length > 0) {
        return;
      }
      if ($pre.find('span.line').length > 0) {
        return;
      }

      var lang = '';

      if (enableLang) {
        lang = CONFIG.code_language.default;
        if ($pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2 && $pre.children().hasClass('hljs')) {
          lang = $pre[0].children[0].classList[1];
        } else if ($pre[0].getAttribute('data-language')) {
          lang = $pre[0].getAttribute('data-language');
        } else if ($pre.parent().hasClass('sourceCode') && $pre[0].children.length > 0 && $pre[0].children[0].classList.length >= 2) {
          lang = $pre[0].children[0].classList[1];
          $pre.parent().addClass('code-wrapper');
        } else if ($pre.parent().hasClass('markdown-body') && $pre[0].classList.length === 0) {
          $pre.wrap('<div class="code-wrapper"></div>');
        }
        lang = lang.toUpperCase().replace('NONE', CONFIG.code_language.default);
      }
      $pre.append(copyTmpl.replace('LANG', lang).replace('code-widget">',
        getBgClass($pre[0]) + (enableCopy ? ' code-widget copy-btn" data-clipboard-snippet><i class="iconfont icon-copy"></i>' : ' code-widget">')));

      if (enableCopy) {
        Fluid.utils.createScript('https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js', function() {
          var clipboard = new window.ClipboardJS('.copy-btn', {
            target: function(trigger) {
              var nodes = trigger.parentNode.childNodes;
              for (var i = 0; i < nodes.length; i++) {
                if (nodes[i].tagName === 'CODE') {
                  return nodes[i];
                }
              }
            }
          });
          clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-copy', 'icon-success');
            setTimeout(function() {
              e.trigger.innerHTML = e.trigger.innerHTML.replace('icon-success', 'icon-copy');
            }, 2000);
          });
        });
      }
    });
  })();
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="/js/leancloud.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
